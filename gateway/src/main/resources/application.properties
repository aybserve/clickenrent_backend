spring.application.name=gateway

# Server Configuration
server.port=8080

# Eureka Client Configuration
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true
eureka.instance.prefer-ip-address=true

# Gateway Configuration
spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# JWT Configuration (must match auth-service)
jwt.secret=${JWT_SECRET:Y2xpY2tlbnJlbnQtc2VjcmV0LWtleS1jaGFuZ2UtaW4tcHJvZHVjdGlvbi0yNTYtYml0}

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,gateway,metrics,prometheus
management.endpoint.health.show-details=always
management.endpoint.gateway.enabled=true
management.endpoint.metrics.enabled=true
management.endpoint.prometheus.enabled=true
management.metrics.export.prometheus.enabled=true

# Logging
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.clickenrent.gateway=DEBUG

# SpringDoc/Swagger Configuration
springdoc.api-docs.enabled=true
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.config-url=/v3/api-docs/swagger-config
springdoc.swagger-ui.urls[0].name=auth-service
springdoc.swagger-ui.urls[0].url=/auth-service/v3/api-docs
springdoc.swagger-ui.urls[1].name=rental-service
springdoc.swagger-ui.urls[1].url=/rental-service/v3/api-docs
springdoc.swagger-ui.urls[2].name=payment-service
springdoc.swagger-ui.urls[2].url=/payment-service/v3/api-docs
springdoc.swagger-ui.urls[3].name=support-service
springdoc.swagger-ui.urls[3].url=/support-service/v3/api-docs
springdoc.swagger-ui.urls[4].name=notification-service
springdoc.swagger-ui.urls[4].url=/notification-service/v3/api-docs
springdoc.swagger-ui.disable-swagger-default-url=true

# Gateway route filtering (disable for Swagger paths)
spring.cloud.gateway.discovery.locator.filters[0]=PreserveHostHeader

# Auth Service Configuration
# URL for auth-service (used for Swagger access validation)
# Use localhost for local development, or service name for Docker/Kubernetes
auth-service.url=http://localhost:8081

# Redis Configuration for Rate Limiting
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.database=0
spring.data.redis.timeout=2000ms

# Redis Connection Pool
spring.data.redis.lettuce.pool.enabled=true
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=2
spring.data.redis.lettuce.pool.max-wait=-1ms

# Redis Health Check
management.health.redis.enabled=true

# Rate Limiting Configuration
rate-limit.enabled=${RATE_LIMIT_ENABLED:true}

# IP-based Rate Limiting (Public Endpoints)
rate-limit.ip.replenish-rate=${RATE_LIMIT_IP_REPLENISH:20}
rate-limit.ip.burst-capacity=${RATE_LIMIT_IP_BURST:30}
rate-limit.ip.ttl-seconds=${RATE_LIMIT_IP_TTL:30}

# User-based Rate Limiting (Authenticated Endpoints)
rate-limit.user.replenish-rate=${RATE_LIMIT_USER_REPLENISH:50}
rate-limit.user.burst-capacity=${RATE_LIMIT_USER_BURST:100}
rate-limit.user.ttl-seconds=${RATE_LIMIT_USER_TTL:60}

# Rate Limit Monitoring
management.metrics.enable.spring.cloud.gateway=true

# Rate Limit Attack Detection
rate-limit.attack.threshold=${RATE_LIMIT_ATTACK_THRESHOLD:10}
rate-limit.attack.block-duration-minutes=${RATE_LIMIT_BLOCK_DURATION:15}
rate-limit.attack.detection-window-minutes=${RATE_LIMIT_DETECTION_WINDOW:5}

# CORS Configuration
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:8080,http://127.0.0.1:3000,http://127.0.0.1:8080}
cors.allowed-methods=${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,PATCH,OPTIONS}
cors.max-age=${CORS_MAX_AGE:3600}
